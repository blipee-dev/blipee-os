# iOS PWA Testing Guide

Complete guide for testing Blipee PWA on iOS with badge support.

## Prerequisites

- **iOS 16.4 or later** - Required for Badge API support
- iPhone or iPad running iOS 16.4+
- Safari browser (badges don't work in Chrome on iOS)

## Installation Steps

### 1. Open in Safari
```
https://yourdomain.com/mobile
```

**Important:** Must use Safari, not Chrome or other browsers. Only Safari supports PWA badges on iOS.

### 2. Add to Home Screen

1. Tap the **Share** button (square with arrow pointing up) at the bottom
2. Scroll down and tap **"Add to Home Screen"**
3. Edit the name if desired (defaults to "Blipee")
4. Tap **"Add"**

### 3. Open from Home Screen

Tap the Blipee icon on your home screen. You should now be running in standalone mode (no Safari UI).

## Testing Badges

### Verify Badge Support

Open the app and check the console (if using Safari Web Inspector):
```
[Badge] Set app badge to X (iOS PWA)
```

If you see this message, badges are working!

### Test Scenarios

#### Scenario 1: Push Notification Badge
1. Enable push notifications in the app
2. Send a test notification from Settings → Notifications
3. **Expected:** Badge appears on home screen icon with count "1"
4. Tap the notification
5. **Expected:** Badge disappears

#### Scenario 2: App Open Badge Sync
1. Have unread notifications in the system
2. Close the app (swipe up to quit)
3. Reopen from home screen
4. **Expected:** Badge syncs with server unread count within 1-2 seconds

#### Scenario 3: Badge Clear on Interaction
1. Have unread notifications (badge showing)
2. Open the app
3. Open the hamburger menu
4. **Expected:** Badge clears immediately

#### Scenario 4: Manual Badge Update
1. Mark notifications as read in the app
2. **Expected:** Badge count decreases in real-time
3. When all read → badge disappears

## Troubleshooting

### Badge Not Showing

**Problem:** No badge appears when notifications arrive

**Solutions:**
1. **Check iOS version:** Settings → General → About → Software Version
   - Must be 16.4 or later

2. **Verify installed as PWA:**
   - Should see "Blipee" on home screen (not just a Safari bookmark)
   - When opened, no Safari address bar should be visible

3. **Check permissions:**
   - Settings → Blipee → Notifications → Allow Notifications: ON

4. **Reinstall the PWA:**
   - Long-press app icon → Remove App
   - Follow installation steps again

### Badge Not Clearing

**Problem:** Badge stays even after reading notifications

**Solutions:**
1. Open the app from home screen (not from multitasking)
2. Interact with the app (open menu, read a message)
3. Force quit and reopen if stuck

### Console Errors

**Error:** `Badge API not supported`
- **Cause:** iOS version < 16.4 or not running as PWA
- **Fix:** Update iOS or reinstall as PWA

**Error:** `setAppBadge failed`
- **Cause:** Browser restrictions or permissions
- **Fix:** Check notification permissions in Settings

## Remote Debugging (Optional)

To see console logs from your iPhone:

1. **On iPhone:**
   - Settings → Safari → Advanced → Web Inspector: ON

2. **On Mac:**
   - Open Safari
   - Develop menu → [Your iPhone name] → [Blipee tab]

3. **View logs:**
   ```
   [Badge] Set app badge to 5 (iOS PWA)
   [Badge] Cleared app badge
   ```

## iOS-Specific Behavior

### Badge Icon
- iOS uses the monochrome badge icon (`badge-icon.png`)
- This is a grayscale version of your app icon
- Automatically generated by our build script

### Badge Limits
- Maximum badge count: 99
- Counts above 99 show as "99+"
- Same behavior as native iOS apps

### Badge Updates
- **Push notification:** Badge updates immediately
- **App open:** Syncs with server (~1-2 sec delay)
- **Manual clear:** Instant when user interacts

### Notification Settings
iOS respects system notification settings:
- **Critical:** Shows immediately, stays until dismissed
- **Time Sensitive:** Appears on lock screen
- **Standard:** May be grouped/delayed

## Testing Checklist

- [ ] iOS 16.4+ installed
- [ ] App installed via "Add to Home Screen" in Safari
- [ ] Push notifications enabled
- [ ] Badge shows on push notification
- [ ] Badge clears on notification tap
- [ ] Badge syncs on app open
- [ ] Badge clears when using app
- [ ] Badge updates when unread count changes
- [ ] No Safari UI visible when running (full PWA mode)

## Known Limitations

1. **Safari Only:** Badges only work in Safari PWA, not Chrome/Firefox on iOS
2. **iOS 16.4+:** Older versions don't support Badge API
3. **Background Limits:** iOS may delay badge updates in low power mode
4. **System Restrictions:** Some enterprise iOS configs may block badges

## Support Matrix

| iOS Version | Badge Support | Notes |
|------------|---------------|-------|
| 16.4+      | ✅ Full       | Recommended |
| 16.0-16.3  | ❌ None       | Update iOS |
| 15.x       | ❌ None       | Update iOS |
| 14.x       | ❌ None       | Update iOS |

## Quick Debug Commands

Run these in Safari Web Inspector console:

```javascript
// Check if Badge API is available
console.log('Badge API:', 'setAppBadge' in navigator);

// Check if running as PWA
console.log('PWA Mode:', window.navigator.standalone);

// Manually set badge
navigator.setAppBadge(5);

// Clear badge
navigator.clearAppBadge();
```

## Questions?

If badges still aren't working:
1. Check iOS version (must be 16.4+)
2. Verify PWA installation (no Safari UI)
3. Check notification permissions
4. Try reinstalling the PWA
5. Check console for error messages

For more help, see the main PWA documentation or contact support.
